<!DOCTYPE html>
<html lang="pt-BR">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>

  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css"
    integrity="sha384-9aIt2nRpC12Uk9gS9baDl411NQApFmC26EwAOH8WgZl5MYYxFfc+NcPb1dKGj7Sk" crossorigin="anonymous" />
</head>

<body onload="listarDados()" style="background-color: #eee;">

  <div class="container p-5">
    <header class="row">
      <h1 class="text-center m-auto"> <strong> COVID-19 </strong></h1>
    </header>

    <div class="row">
      <h4 class="my-4 ml-3" style="color: #555;">Cadastrar Caso</h4>
    </div>

    <form>

      <div class="form-group">
        <label for="name">Nome</label>
        <input type="text" class="form-control" id="name" aria-describedby="emailHelp">
      </div>

      <div class="form-gorup row">

        <div class="col">
          <label for="healthProblem">Problemas de Saude</label>
          <input type="text" class="form-control" id="healthProblem" aria-describedby="emailHelp">
        </div>

        <div class="col">
          <label for="celphone">Telefone Celular</label>
          <input type="text" class="form-control" id="celphone" aria-describedby="emailHelp">
        </div>

      </div>

      <div class="form-group row pt-3">
        <div class="col">
          <label for="wheiht">Peso</label>
          <input type="text" class="form-control" id="wheiht" aria-describedby="emailHelp">
        </div>

        <div class="col">
          <label for="height">Altura</label>
          <input type="text" class="form-control" id="height" aria-describedby="emailHelp">
        </div>
      </div>

      <div class="form-gorup row">

        <div class="col">
          <label for="city">Cidade</label>
          <input type="text" class="form-control" id="city" aria-describedby="emailHelp">
        </div>

        <div class="col">
          <label for="neighborhood">Bairro</label>
          <input type="text" class="form-control" id="neighborhood" aria-describedby="emailHelp">
        </div>

      </div>

      <div class="form-gorup row pt-3">

        <div class="col">
          <label for="street">Rua</label>
          <input type="text" class="form-control" id="street" aria-describedby="emailHelp">
        </div>

        <div class="col">
          <label for="number">Numero</label>
          <input type="number" class="form-control" id="number" aria-describedby="emailHelp">
        </div>

      </div>

      <button onclick="cadastrar()" type="button" class="btn btn-secondary btn-block mt-4"> <strong> Cadastrar
        </strong></button>
      <button type="button" class="btn btn-primary btn-block mt-4" data-toggle="modal" data-target="#exampleModal">
        <strong> Atualizar Dados </strong>
      </button>
    </form>

    <div class="row">
      <h4 class="my-4 ml-3" style="color: #555;">Casos Cadastrados</h4>
    </div>

    <!-- Tabela -->
    <table class="table table-dark" id="table">
      <thead>
        <tr>
          <th scope="col">ID</th>
          <th scope="col">Nome</th>
          <th scope="col">Peso</th>
          <th scope="col">Altura</th>
          <th scope="col">Deletar</th>
        </tr>
      </thead>
      <tbody>
      </tbody>
    </table>
  </div>

  <!-- Modal -->
  <div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
    aria-hidden="true">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="exampleModalLabel">Atualizar dados</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          <form>

            <div class="form-group row">
              <div class="col">
                <label for="id">ID</label>
                <input type="text" class="form-control" id="idModal" aria-describedby="emailHelp">
              </div>

              <div class="col">
                <label for="name">Nome</label>
                <input type="text" class="form-control" id="nameModal" aria-describedby="emailHelp">
              </div>

            </div>

            <div class="form-gorup row">

              <div class="col">
                <label for="healthProblem">Problemas de Saude</label>
                <input type="text" class="form-control" id="healthProblemModal" aria-describedby="emailHelp">
              </div>

              <div class="col">
                <label for="celphone">Telefone Celular</label>
                <input type="text" class="form-control" id="celphoneModal" aria-describedby="emailHelp">
              </div>

            </div>

            <div class="form-group row pt-3">
              <div class="col">
                <label for="wheiht">Peso</label>
                <input type="text" class="form-control" id="wheihtModal" aria-describedby="emailHelp">
              </div>

              <div class="col">
                <label for="height">Altura</label>
                <input type="text" class="form-control" id="heightModal" aria-describedby="emailHelp">
              </div>
            </div>

            <div class="form-gorup row">

              <div class="col">
                <label for="city">Cidade</label>
                <input type="text" class="form-control" id="cityModal" aria-describedby="emailHelp">
              </div>

              <div class="col">
                <label for="neighborhood">Bairro</label>
                <input type="text" class="form-control" id="neighborhoodModal" aria-describedby="emailHelp">
              </div>

            </div>

            <div class="form-gorup row pt-3">

              <div class="col">
                <label for="street">Rua</label>
                <input type="text" class="form-control" id="streetModal" aria-describedby="emailHelp">
              </div>

              <div class="col">
                <label for="number">Numero</label>
                <input type="number" class="form-control" id="numberModal" aria-describedby="emailHelp">
              </div>

            </div>

          </form>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-dismiss="modal">Fechar</button>
          <button onclick="atualizar()" type="button" class="btn btn-primary">Atualizar</button>
        </div>
      </div>
    </div>
  </div>

  <script>

    let modelData = [
      {
        id: '123',
        name: 'Maria',
        healthProblem: 'Pressão Alta',
        celphone: '2798888888',
        wheiht: '80',
        height: '1,68',
        city: 'Vitoria',
        neighborhood: 'Centro',
        street: 'Av Vitoria',
        number: '125'
      },
      {
        id: '124',
        name: 'Joao',
        healthProblem: 'Pressão Alta',
        celphone: '2798888888',
        wheiht: '80',
        height: '1,68',
        city: 'Vitoria',
        neighborhood: 'Centro',
        street: 'Av Vitoria',
        number: '125'
      },
      ,
      {
        id: '125',
        name: 'Joana',
        healthProblem: 'Pressão Alta',
        celphone: '2798888888',
        wheiht: '80',
        height: '1,68',
        city: 'Vitoria',
        neighborhood: 'Centro',
        street: 'Av Vitoria',
        number: '125'
      },
      ,
      {
        id: '126',
        name: 'Mario',
        healthProblem: 'Pressão Alta',
        celphone: '2798888888',
        wheiht: '80',
        height: '1,68',
        city: 'Vitoria',
        neighborhood: 'Centro',
        street: 'Av Vitoria',
        number: '125'
      },
      ,
      {
        id: '127',
        name: 'Matheus',
        healthProblem: 'Pressão Alta',
        celphone: '2798888888',
        wheiht: '80',
        height: '1,68',
        city: 'Vitoria',
        neighborhood: 'Centro',
        street: 'Av Vitoria',
        number: '125'
      },
    ]

    function uuidv4() {
      return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, (c) => {
        var r = Math.random() * 16 | 0, v = c == 'x' ? r : (r & 0x3 | 0x8);
        return v.toString(16);
      });
    }

    async function atualizar() {

      const name = document.getElementById("nameModal").value
      const id = document.getElementById("IdModal").value
      const healthProblem = document.getElementById("healthProblemModal").value
      const celphone = document.getElementById("celphoneModal").value
      const wheiht = document.getElementById("wheihtModal").value
      const height = document.getElementById("heightModal").value
      const city = document.getElementById("cityModal").value
      const neighborhood = document.getElementById("neighborhoodModal").value
      const street = document.getElementById("streetModal").value
      const number = document.getElementById("numberModal").value

      try {

        modelData.push({ name, id, healthProblem, celphone, wheiht, height, city, neighborhood, street, number })

        await fetch('https://www.url-api.com.br', {
          method: 'POST',
          mode: 'cors',
          body: {
            name, id, healthProblem, celphone, wheiht, height, city, neighborhood, street, number
          }
        })

      } catch (error) {
        alert('Erro ao realizar a requisição. Verifique a URL da API')
      }

    }

    async function cadastrar() {

      const id = uuidv4();
      const name = document.getElementById("name").value;
      const healthProblem = document.getElementById("healthProblem").value;
      const celphone = document.getElementById("celphone").value;
      const wheiht = document.getElementById("wheiht").value;
      const height = document.getElementById("height").value;
      const city = document.getElementById("city").value;
      const neighborhood = document.getElementById("neighborhood").value;
      const street = document.getElementById("street").value;
      const number = document.getElementById("number").value;



      try {

        await fetch('https://www.url-api.com.br', {
          method: 'POST',
          mode: 'cors',
          body: {
            id,
            name,
            healthProblem,
            celphone,
            wheiht,
            height,
            city,
            neighborhood,
            street,
            number
          }
        })

        let table = document.getElementById('table')

        let row = table.insertRow(1)

        let cell0 = row.insertCell(0)
        let cell1 = row.insertCell(1)
        let cell2 = row.insertCell(2)
        let cell3 = row.insertCell(3)
        let cell4 = row.insertCell(4)

        cell0.innerHTML = id
        cell1.innerHTML = name
        cell2.innerHTML = wheiht
        cell3.innerHTML = height
        cell4.innerHTML = `<td><button onclick="deletar(${data.id})" class="btn btn-danger">Deletar</button></td>`

      } catch (error) {
        alert('Erro ao realizar a requisição. Verifique a URL da API')
      }

    }

    async function listarDados() {
      console.log('entrou 0')

      try {
        const response = await fetch('https://www.url-api.com.br')
        const responseJSON = await response.json()

        responseJSON.map((data) => {

          let table = document.getElementById('table')
          let row = table.insertRow(1)

          let cell0 = row.insertCell(0)
          let cell1 = row.insertCell(1)
          let cell2 = row.insertCell(2)
          let cell3 = row.insertCell(3)
          let cell4 = row.insertCell(4)

          cell0.innerHTML = data.id
          cell1.innerHTML = data.name
          cell2.innerHTML = data.wheiht
          cell3.innerHTML = data.height
          cell4.innerHTML = `<td><button onclick="deletar(${data.id})" class="btn btn-danger">Deletar</button></td>`

        })

      } catch (error) {
        modelData.map((data) => {

          let table = document.getElementById('table')
          let row = table.insertRow(1)

          let cell0 = row.insertCell(0)
          let cell1 = row.insertCell(1)
          let cell2 = row.insertCell(2)
          let cell3 = row.insertCell(3)
          let cell4 = row.insertCell(4)

          cell0.innerHTML = data.id
          cell1.innerHTML = data.name
          cell2.innerHTML = data.wheiht
          cell3.innerHTML = data.height
          cell4.innerHTML = `<td><button onclick="deletar(${data.id})" class="btn btn-danger">Deletar</button></td>`

        });
      };
    };

    async function deletar(id) {
      console.log(id)

      try {

        const deleted = await fetch(`https://www.url-api.com.br/${id}`, {
          method: "DELETE",
          mode: "cors"
        })

        if (deleted) {
          return document.location.reload()
        }

      } catch (error) {
        alert('Erro ao deletar, verifique a URL da API')
      }
    }
  </script>

  <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"
    integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj"
    crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"
    integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo"
    crossorigin="anonymous"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js"
    integrity="sha384-OgVRvuATP1z7JjHLkuOU7Xw704+h835Lr+6QL9UvYjZE3Ipu6Tp75j7Bh/kR0JKI"
    crossorigin="anonymous"></script>
</body>

</html>